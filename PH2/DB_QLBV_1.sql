
/*
alter session set "_oracle_script" = true;

DROP USER AdminOfHospital CASCADE;
/
create user AdminOfHospital identified by 1234;
/
grant connect, resource, dba to AdminOfHospital with admin option; 
GRANT CREATE USER, DROP USER, ALTER USER TO AdminOfHospital CONTAINER = ALL;
GRANT CREATE PROCEDURE, EXECUTE ANY PROCEDURE TO AdminOfHospital WITH ADMIN OPTION;
/
connect AdminOfHospital/1234;
show user;
/
*/
alter session set "_oracle_script" = true;
/
-------------------------------- TAO BANG CHO CSDL BENH VIEN --------------------------------

--drop table--
drop table CTHoaDon;
drop table hoadon;
drop table hoso_dichvu;
drop table dichvu;
drop table chitietdonthuoc;
drop table thuoc;
drop table chamcong;
drop table donthuoc;
drop table hosobenhnhan;
drop table benhnhan;
drop table nhanvien;
drop table donvi;
drop table QUANLY_USER;
/

-- TAO TABLE BENHNHAN
CREATE TABLE BENHNHAN 
(
  MABN VARCHAR2(10 BYTE) NOT NULL 
, HOTEN VARCHAR2(20 BYTE) NOT NULL 
, NGAYSINH DATE 
, DIACHI VARCHAR2(20 BYTE) 
, SODT VARCHAR2(20 BYTE) 
, CONSTRAINT BENHNHAN_PK PRIMARY KEY 
  (
    MABN 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX BENHNHAN_PK ON BENHNHAN (MABN ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE NHANVIEN
CREATE TABLE NHANVIEN 
(
  MANV VARCHAR2(20 BYTE) NOT NULL 
, HOTEN VARCHAR2(20 BYTE) NOT NULL 
, GIOITINH VARCHAR2(10 BYTE) NOT NULL 
, NGAYSINH DATE NOT NULL 
, QUEQUAN VARCHAR2(100 BYTE) 
, DIACHI VARCHAR2(100 BYTE) 
, SODT VARCHAR2(15 BYTE) 
, LUONG NUMBER 
, VAITRO VARCHAR2(50 BYTE) 
, DONVI VARCHAR2(10 BYTE) 
, CONSTRAINT NHANVIEN_PK PRIMARY KEY 
  (
    MANV 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX NHANVIEN_PK ON NHANVIEN (MANV ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

ALTER TABLE NHANVIEN
ADD CONSTRAINT GENDER_CHECK CHECK 
(GIOITINH in ('Nam', 'Nu'))
ENABLE;
/

-- TAO TABLE CHAMCONG
CREATE TABLE CHAMCONG 
    (MANV VARCHAR2(20 BYTE) NOT NULL,
    THANG NUMBER NOT NULL,
    NAM NUMBER NOT NULL,
    SONGAYCONG NUMBER,
    CONSTRAINT CHAMCONG_PK PRIMARY KEY(MANV, THANG, NAM))
/
-- TAO TABLE CHITIETDONTHUOC
CREATE TABLE CHITIETDONTHUOC 
(
  MAKB VARCHAR2(20 BYTE) NOT NULL 
, MATHUOC VARCHAR2(20 BYTE) NOT NULL 
, SOLUONG NUMBER 
, LIEUDUNG VARCHAR2(20 BYTE) 
, MOTA VARCHAR2(100 BYTE) 
, CONSTRAINT CHITIETDONTHUOC_PK PRIMARY KEY 
  (
    MAKB 
  , MATHUOC 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX CHITIETDONTHUOC_PK ON CHITIETDONTHUOC (MAKB ASC, MATHUOC ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE CTHOADON
CREATE TABLE CTHOADON 
(
  SOHD VARCHAR2(20 BYTE) NOT NULL 
, MADV VARCHAR2(20 BYTE) NOT NULL 
, CONSTRAINT CTHOADON_PK PRIMARY KEY 
  (
    SOHD 
  , MADV 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX CTHOADON_PK ON CTHOADON (SOHD ASC, MADV ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE DICHVU
CREATE TABLE DICHVU 
(
  MADV VARCHAR2(20 BYTE) NOT NULL 
, TENDV VARCHAR2(20 BYTE) 
, DONGIA NUMBER 
, CONSTRAINT DICHVU_PK PRIMARY KEY 
  (
    MADV 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX TABLE1_PK ON DICHVU (MADV ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE DONTHUOC
CREATE TABLE DONTHUOC 
(
  MAKB VARCHAR2(20 BYTE) NOT NULL 
, NVPT VARCHAR2(20 BYTE) 
, CONSTRAINT DONTHUOC_PK PRIMARY KEY 
  (
    MAKB 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX DONTHUOC_PK ON DONTHUOC (MAKB ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE DONVI
CREATE TABLE DONVI 
(
  MADV VARCHAR2(20 BYTE) NOT NULL 
, TENDONVI VARCHAR2(20 BYTE) 
, CONSTRAINT DONVI_PK PRIMARY KEY 
  (
    MADV 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX DONVI_PK ON DONVI (MADV ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE HOADON
CREATE TABLE HOADON 
(
  SOHD VARCHAR2(20 BYTE) NOT NULL 
, MAKB VARCHAR2(20 BYTE) 
, NGAYHD DATE 
, NGUOIPT VARCHAR2(20 BYTE) 
, TONGTIEN NUMBER 
, CONSTRAINT TABLE1_PK PRIMARY KEY 
  (
    SOHD 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX TABLE1_PK2 ON HOADON (SOHD ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE HOSO_DICHVU
CREATE TABLE HOSO_DICHVU 
(
  MAKB VARCHAR2(20 BYTE) NOT NULL 
, MADV VARCHAR2(20 BYTE) NOT NULL 
, NGAY_GIO DATE 
, NGUOITHUCHIEN VARCHAR2(20 BYTE) 
, KETLUAN VARCHAR2(20 BYTE) 
, CONSTRAINT HOSO_DICHVU_PK PRIMARY KEY 
  (
    MAKB 
  , MADV 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX HOSO_DICHVU_PK ON HOSO_DICHVU (MAKB ASC, MADV ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE HOSOBENHNHAN
CREATE TABLE HOSOBENHNHAN 
(
  MAKB VARCHAR2(20 BYTE) NOT NULL 
, NGAYKB DATE 
, MATT VARCHAR2(20 BYTE) 
, MABS VARCHAR2(20 BYTE) 
, MABN VARCHAR2(20 BYTE) 
, TINHTRANGBANDAU VARCHAR2(100 BYTE) 
, KETLUANCUABS VARCHAR2(100 BYTE) 
, CONSTRAINT HOSOBENHNHAN_PK PRIMARY KEY 
  (
    MAKB 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX HOSOBENHNHAN_PK ON HOSOBENHNHAN (MAKB ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

-- TAO TABLE THUOC
CREATE TABLE THUOC 
(
  MATHUOC VARCHAR2(20 BYTE) NOT NULL 
, TENTHUOC VARCHAR2(50 BYTE) 
, DVT VARCHAR2(20 BYTE) 
, DONGIA NUMBER 
, LUUY VARCHAR2(100 BYTE) 
, CONSTRAINT THUOC_PK PRIMARY KEY 
  (
    MATHUOC 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX TABLE1_PK1 ON THUOC (MATHUOC ASC) 
      LOGGING 
      TABLESPACE USERS 
      PCTFREE 10 
      INITRANS 2 
      STORAGE 
      ( 
        BUFFER_POOL DEFAULT 
      ) 
      NOPARALLEL 
  )
  ENABLE 
)
/

CREATE TABLE QUANLY_USER(
ID NUMBER,
USERNAME CHAR(30),
PASSWORD CHAR(20),
LASTUPDATE TIMESTAMP,
CONSTRAINT FK_QLU PRIMARY KEY (ID)
)
/

-------------------------------- TAO CONTSTRAINT --------------------------------
-- CHAMCONG.MANV -> NHANVIEN.MANV
ALTER TABLE CHAMCONG
ADD CONSTRAINT CHAMCONG_FK1 FOREIGN KEY
(
  MANV 
)
REFERENCES NHANVIEN
(
  MANV 
)
ENABLE;
/

-- CHITIETDONTHUOC.MAKB -> HOSOBENHNHAN.MAKB
ALTER TABLE CHITIETDONTHUOC
ADD CONSTRAINT CHITIETDONTHUOC_FK1 FOREIGN KEY
(
  MAKB 
)
REFERENCES HOSOBENHNHAN
(
  MAKB 
)
ENABLE;
/

-- CHITIETDONTHUOC.MATHUOC -> THUOC.MATHUOC
ALTER TABLE CHITIETDONTHUOC
ADD CONSTRAINT CHITIETDONTHUOC_FK2 FOREIGN KEY
(
  MATHUOC 
)
REFERENCES THUOC
(
  MATHUOC 
)
ENABLE;
/

-- CTHOADON.SOHD -> HOADON.SOHD
ALTER TABLE CTHOADON
ADD CONSTRAINT CTHOADON_FK1 FOREIGN KEY
(
  SOHD 
)
REFERENCES HOADON
(
  SOHD 
)
ENABLE;
/

-- CTHOADON.MADV -> DICHVU.MADV
ALTER TABLE CTHOADON
ADD CONSTRAINT CTHOADON_FK2 FOREIGN KEY
(
  MADV 
)
REFERENCES DICHVU
(
  MADV 
)
ENABLE;
/

-- DONTHUOC.MAKB -> HOSOBENHNHAN.MAKB
ALTER TABLE DONTHUOC
ADD CONSTRAINT DONTHUOC_FK2 FOREIGN KEY
(
  MAKB 
)
REFERENCES HOSOBENHNHAN
(
  MAKB 
)
ENABLE;
/

-- DONTHUOC.NVPT -> NHANVIEN.MANV		-- NVPT: Nhan vien phong thuoc
ALTER TABLE DONTHUOC
ADD CONSTRAINT DONTHUOC_FK1 FOREIGN KEY
(
  NVPT
)
REFERENCES NHANVIEN
(
  MANV 
)
ENABLE;
/

-- HOADON.MAKB -> HOSOBENHNHAN.MAKB
ALTER TABLE HOADON
ADD CONSTRAINT HOADON_FK1 FOREIGN KEY
(
  MAKB 
)
REFERENCES HOSOBENHNHAN
(
  MAKB 
)
ENABLE;
/

-- HOSO_DICHVU.MADV -> DICHVU.MADV
ALTER TABLE HOSO_DICHVU
ADD CONSTRAINT HOSO_DICHVU_FK1 FOREIGN KEY
(
  MADV 
)
REFERENCES DICHVU
(
  MADV 
)
ENABLE;
/

-- HOADON.NGUOIPT -> NHANVIEN.MANV
ALTER TABLE HOADON		-- NGUOIPT: Nguoi phat thuoc
ADD CONSTRAINT HOADON_FK2 FOREIGN KEY
(
  NGUOIPT 
)
REFERENCES NHANVIEN
(
  MANV
)
ENABLE;
/

-- HOSO_DICHVU.MAKB -> HOSOBENHNHAN.MAKB
ALTER TABLE HOSO_DICHVU
ADD CONSTRAINT HOSO_DICHVU_FK2 FOREIGN KEY
(
  MAKB 
)
REFERENCES HOSOBENHNHAN
(
  MAKB 
)
ENABLE;
/

-- HOSO_DICHVU.NGUOITHUCHIEN -> NHANVIEN.MANV
ALTER TABLE HOSO_DICHVU
ADD CONSTRAINT HOSO_DICHVU_FK3 FOREIGN KEY
(
  NGUOITHUCHIEN 
)
REFERENCES NHANVIEN
(
  MANV 
)
ENABLE;
/

-- HOSOBENHNHAN.MATT -> NHANVIEN.MANV		-- Ma tiep tan
ALTER TABLE HOSOBENHNHAN
ADD CONSTRAINT HOSOBENHNHAN_FK1 FOREIGN KEY
(
  MATT 
)
REFERENCES NHANVIEN
(
  MANV 
)
ENABLE;
/

-- HOSOBENHNHAN.MABS -> NHANVIEN.MANV		-- Ma bac si
ALTER TABLE HOSOBENHNHAN
ADD CONSTRAINT HOSOBENHNHAN_FK2 FOREIGN KEY
(
  MABS 
)
REFERENCES NHANVIEN
(
  MANV 
)
ENABLE;
/

-- HOSOBENHNHAN.MABN -> BENHNHAN.MABN
ALTER TABLE HOSOBENHNHAN
ADD CONSTRAINT HOSOBENHNHAN_FK3 FOREIGN KEY
(
  MABN 
)
REFERENCES BENHNHAN
(
  MABN 
)
ENABLE;

-- NHANVIEN.DONVI -> DONVI.MADV
ALTER TABLE NHANVIEN
ADD CONSTRAINT NHANVIEN_FK1 FOREIGN KEY
(
  DONVI 
)
REFERENCES DONVI
(
  MADV 
)
ENABLE;

--------------- TRIGGER -------------
--TU DONG INSERT USERNAME VA PASSWORD VAO BANG QUANLY_USER SAU KHI INSERT VAO BANG NHANVIEN
--(PASSWORD SE DUOC MA HOA SAU)
set serveroutput on;
CREATE OR REPLACE TRIGGER NHANVIEN_AFTER_INSERT
AFTER INSERT
   ON NHANVIEN
   FOR EACH ROW
DECLARE
    U_NAME VARCHAR(30);
BEGIN
    U_NAME := 'U_QLBV_' || :new.MANV;
    -- DBMS_OUTPUT.PUT_LINE(U_NAME);
    INSERT INTO QUANLY_USER(USERNAME, PASSWORD, LASTUPDATE)
    VALUES(U_NAME, :new.MANV, CURRENT_TIMESTAMP);
END;
/
--DU DONG CHEN COT ID (TU DONG TANG) VAO BANG QUANLY_USER KHI INSERT MOT DONG MOI VAO BANG NAY
DROP SEQUENCE AUTO_INCREMENT_SEQUENCE;
/
CREATE SEQUENCE AUTO_INCREMENT_SEQUENCE
START WITH 100
INCREMENT BY 1;
/
CREATE OR REPLACE TRIGGER AUTO_INCREMENT_TRIGGER
BEFORE INSERT ON QUANLY_USER
REFERENCING NEW AS NEW
    FOR EACH ROW
BEGIN    
    SELECT AUTO_INCREMENT_SEQUENCE.NEXTVAL INTO :NEW.ID
    FROM DUAL;
END;
/
--SP TAO USER--
CREATE OR REPLACE PROCEDURE SP_CREATE_USER
IS
U_NAME CHAR(30);
P_WORD CHAR(20);
CURSOR USERNAME_PASSWORD IS
    SELECT DISTINCT USERNAME, PASSWORD
    FROM QUANLY_USER;
BEGIN
    OPEN USERNAME_PASSWORD;
    LOOP
        FETCH USERNAME_PASSWORD INTO U_NAME, P_WORD;
        EXIT WHEN USERNAME_PASSWORD%NOTFOUND;
        --DBMS_OUTPUT.PUT_LINE('CREATE USER U_QLBV_' || U_NAME ||' IDENTIFIED BY '||P_WORD);
        --DBMS_OUTPUT.PUT_LINE('GRANT CONNECT TO U_QLBV_' || U_NAME);
        EXECUTE IMMEDIATE ('CREATE USER ' || U_NAME ||' IDENTIFIED BY '||P_WORD);
        EXECUTE IMMEDIATE ('GRANT CONNECT TO ' || U_NAME);  
    END LOOP;
    CLOSE USERNAME_PASSWORD;
END;
/
--SP XOA USER--
CREATE OR REPLACE PROCEDURE SP_DROP_USER
IS
U_NAME CHAR(30);
CURSOR C_USERNAME IS
    SELECT DISTINCT USERNAME
    FROM QUANLY_USER;
BEGIN
    OPEN C_USERNAME;
    LOOP
        FETCH C_USERNAME INTO U_NAME;
        EXIT WHEN C_USERNAME%NOTFOUND;
        --DBMS_OUTPUT.PUT_LINE('DROP USER U_QLBV_' || U_NAME);
        EXECUTE IMMEDIATE ('DROP USER ' || U_NAME);
    END LOOP;
    CLOSE C_USERNAME;
END;
/
----------------NHAP LIEU---------------
-----BANG BENH NHAN
INSERT INTO BENHNHAN(MABN, HOTEN, NGAYSINH, DIACHI, SODT) VALUES ('1712468','VO CONG HUAN', to_date('31-03-1999','dd-mm-yyyy'), '20 NGUYEN TRAI', '0994639649');
INSERT INTO BENHNHAN(MABN, HOTEN, NGAYSINH, DIACHI, SODT) VALUES ('1712470','NGUYEN VAN TUAN', to_date('15-02-1999','dd-mm-yyyy'), '05 NGUYEN OANH', '0909778699');
INSERT INTO BENHNHAN(MABN, HOTEN, NGAYSINH, DIACHI, SODT) VALUES ('1712469','VO TAN HOI', to_date('22-12-1999','dd-mm-yyyy'), '54 NGO GIA TU', '0937523754');
INSERT INTO BENHNHAN(MABN, HOTEN, NGAYSINH, DIACHI, SODT) VALUES ('1712471','VO THI HONG', to_date('05-10-1999','dd-mm-yyyy'), '37 TRUONG SA', '0998352754');
INSERT INTO BENHNHAN(MABN, HOTEN, NGAYSINH, DIACHI, SODT) VALUES ('18120447','LE HOANG LONG', to_date('01-07-2000','dd-mm-yyyy'), '04 PHU THO', '0945309564');
-----BANG DON VI 
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D001', 'BO PHAN QUAN LY');
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D002', 'BO PHAN TIEP TAN');
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D003', 'BAC SI DIEU TRI');
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D004', 'PHONG TAI VU');
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D005', 'PHONG BAN THUOC');
INSERT INTO DONVI(MADV, TENDONVI) VALUES ('D006', 'PHONG KE TOAN');
-----BANG NHAN VIEN
--NV QUAN LI
INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('QL001', 'NGUYEN QUANG HAI', 'Nam', to_date('31-08-1984','dd-mm-yyyy'),'BINH DUONG', '12 THU KHOA HUAN', '0998124756', 4000000, NULL, 'D001');

--NV TIEP TAN
INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('TT001', 'NGUYEN VAN MINH', 'Nam', to_date('02-10-1989','dd-mm-yyyy') ,'BEN TRE', '101 LY THUONG KIET', '0953124532', 5000000, NULL, 'D002');

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('TT002', 'VU VAN THANH', 'Nam', to_date('04-01-1988','dd-mm-yyyy'), 'DONG THAP', '200 NGUYEN DU', '0912542764', 5000000, NULL, 'D002');

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('BS001', 'LE THI NGOC', 'Nu', to_date('18-02-1986','dd-mm-yyyy'),'BINH PHUOC', '40 LE LAI', '0968934632', 10000000, NULL, 'D003');

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('BS002', 'BUI VAN SI', 'Nam', to_date('24-07-1980','dd-mm-yyyy'),'TP HCM', '50 DONG KHOI', '0932533243', 11000000, NULL, 'D003'); 
--NV TAI VU

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('TV001', 'LE THI TU ANH', 'Nu', to_date('18-02-1986','dd-mm-yyyy'),'DONG NAI', '07 HA HUY GIAP', '0993603100', 6000000, NULL, 'D004');

--NV BAN THUOC
INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('BT001', 'NGUYEN CONG PHUONG', 'Nam', to_date('08-06-1989','dd-mm-yyyy'), 'CA MAU', '12 NGUYEN HUE', '0992435875',7000000, NULL, 'D005');

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('BT002', 'DO HUNG DUNG', 'Nam', to_date('18-05-1990','dd-mm-yyyy'), 'VINH', '122 CHU VAN AN', '0923143642', 6500000, NULL, 'D005');
--NV KE TOAN

INSERT INTO NHANVIEN(MANV, HOTEN, GIOITINH, NGAYSINH, QUEQUAN, DIACHI, SODT, LUONG, VAITRO, DONVI) 
VALUES ('KT001', 'HO NGOC TRRAM', 'Nu', to_date('18-11-1987','dd-mm-yyyy'), 'HUE', '44 NGUYEN OANH', '0989255993', 7000000 ,NULL, 'D006');



----BANG HO SO BENH NHAN
INSERT INTO HOSOBENHNHAN(MAKB, NGAYKB, MATT, MABS, MABN, TINHTRANGBANDAU, KETLUANCUABS) 
VALUES ('KB001', to_date('22-01-2021','dd-mm-yyyy'), 'TT001', 'TT002', '1712468', 'BINH THUONG', 'BINH THUONG');
INSERT INTO HOSOBENHNHAN(MAKB, NGAYKB, MATT, MABS, MABN, TINHTRANGBANDAU, KETLUANCUABS) 
VALUES ('KB002', to_date('18-02-2021','dd-mm-yyyy'), 'BS002', 'BS001', '1712470', 'DAU DA DAY', 'VIEM DA DAY');
INSERT INTO HOSOBENHNHAN(MAKB, NGAYKB, MATT, MABS, MABN, TINHTRANGBANDAU, KETLUANCUABS) 
VALUES ('KB003', to_date('05-03-2021','dd-mm-yyyy'), 'BS002', 'TT002', '1712469', 'BINH THUONG', 'MAU NHIEM MO');
INSERT INTO HOSOBENHNHAN(MAKB, NGAYKB, MATT, MABS, MABN, TINHTRANGBANDAU, KETLUANCUABS) 
VALUES ('KB004', to_date('30-05-2021','dd-mm-yyyy'), 'TT001', 'BS001', '1712471', 'HO VA SOT', 'NHIEM COVID');
INSERT INTO HOSOBENHNHAN(MAKB, NGAYKB, MATT, MABS, MABN, TINHTRANGBANDAU, KETLUANCUABS) 
VALUES ('KB005', to_date('11-10-2021','dd-mm-yyyy'), 'BS002', 'TT002', '18120447', 'BINH THUONG', 'BEO PHI CAP DO 1');

-----BANG CHAM CONG
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('QL001', 5, 2021, 31);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('TT001', 2, 2021, 28);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('TT002', 12, 2020, 30);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('BS001', 3, 2021, 15);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('BS002', 8, 2020, 29);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('TV001', 7, 2020, 31);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('BT001', 10, 2020, 30);
INSERT INTO CHAMCONG(MANV, THANG, NAM, SONGAYCONG) VALUES ('BT002', 1, 2021, 20);

-----BANG THUOC 
INSERT INTO THUOC(MATHUOC, TENTHUOC, DVT, DONGIA,LUUY) VALUES ('T001', 'GASTROPULGITE' ,'HOP', 100000, NULL);
INSERT INTO THUOC(MATHUOC, TENTHUOC, DVT, DONGIA,LUUY) VALUES ('T002', 'FLAGYL', 'VI', 200000, 'KHONG DANH CHO TRE DUOI 15 TUOI');
INSERT INTO THUOC(MATHUOC, TENTHUOC, DVT, DONGIA,LUUY) VALUES ('T003', 'METHORPHAN', 'VIEN', 50000, 'UONG SAU KHI AN');
INSERT INTO THUOC(MATHUOC, TENTHUOC, DVT, DONGIA,LUUY) VALUES ('T004', 'SINGULAIR', 'LO', 300000, 'KHONG DANH CHO PHU NU CO THAI');
INSERT INTO THUOC(MATHUOC, TENTHUOC, DVT, DONGIA,LUUY) VALUES ('T005', 'NITROGLYCERINE', 'HOP',450000, NULL);

-----BANG CHI TIET DON THUOC
INSERT INTO CHITIETDONTHUOC(MAKB, MATHUOC, SOLUONG, LIEUDUNG, MOTA) VALUES ('KB001', 'T001', 2, '2 VIEN/LAN', 'SANG TOI');
INSERT INTO CHITIETDONTHUOC(MAKB, MATHUOC, SOLUONG, LIEUDUNG, MOTA) VALUES ('KB002', 'T002', 4, '3 VIEN/LAN', 'SANG TRUA TOI');
INSERT INTO CHITIETDONTHUOC(MAKB, MATHUOC, SOLUONG, LIEUDUNG, MOTA) VALUES ('KB003', 'T003', 6, '1 VIEN/LAN', 'SANG CHIU SAU KHI AN');
INSERT INTO CHITIETDONTHUOC(MAKB, MATHUOC, SOLUONG, LIEUDUNG, MOTA) VALUES ('KB004', 'T004', 5, '4 VIEN/LAN', 'TRUA TOI');
INSERT INTO CHITIETDONTHUOC(MAKB, MATHUOC, SOLUONG, LIEUDUNG, MOTA) VALUES ('KB005', 'T005', 3, '2 VIEN/LAN', 'SANG TOI TRUOC KHI AN');

-----BANG DICH VU
INSERT INTO DICHVU(MADV, TENDV, DONGIA) VALUES ('DV001', 'KHAM TONG QUAT', 100000);
INSERT INTO DICHVU(MADV, TENDV, DONGIA) VALUES ('DV002', 'CHUP X-QUANG', 200000);
INSERT INTO DICHVU(MADV, TENDV, DONGIA) VALUES ('DV003', 'KHAM TAI MUI HONG', 300000);
INSERT INTO DICHVU(MADV, TENDV, DONGIA) VALUES ('DV004', 'SIEU AM', 250000);
INSERT INTO DICHVU(MADV, TENDV, DONGIA) VALUES ('DV005', 'NOI SOI', 500000);

----BANG HOA DON
INSERT INTO HOADON(SOHD, MAKB, NGAYHD, NGUOIPT, TONGTIEN) VALUES ('HD001', 'KB002', to_date('22-01-2021','dd-mm-yyyy'), 'TV001', 1500000);
INSERT INTO HOADON(SOHD, MAKB, NGAYHD, NGUOIPT, TONGTIEN) VALUES ('HD002', 'KB004', to_date('05-03-2021','dd-mm-yyyy'), 'TV001', 500000);
INSERT INTO HOADON(SOHD, MAKB, NGAYHD, NGUOIPT, TONGTIEN) VALUES ('HD003', 'KB005', to_date('18-02-2021','dd-mm-yyyy'), 'TV001', 750000);
INSERT INTO HOADON(SOHD, MAKB, NGAYHD, NGUOIPT, TONGTIEN) VALUES ('HD004', 'KB003', to_date('11-10-2021','dd-mm-yyyy'), 'TV001', 800000);
INSERT INTO HOADON(SOHD, MAKB, NGAYHD, NGUOIPT, TONGTIEN) VALUES ('HD005', 'KB001', to_date('30-05-2021','dd-mm-yyyy'), 'TV001', 1000000);

-----BANG CHI TIET HOA DON
INSERT INTO CTHOADON(SOHD, MADV) VALUES ('HD001', 'DV001');
INSERT INTO CTHOADON(SOHD, MADV) VALUES ('HD002', 'DV003');
INSERT INTO CTHOADON(SOHD, MADV) VALUES ('HD003', 'DV002');
INSERT INTO CTHOADON(SOHD, MADV) VALUES ('HD004', 'DV005');
INSERT INTO CTHOADON(SOHD, MADV) VALUES ('HD005', 'DV001');

-----BANG DON THUOC 
INSERT INTO DONTHUOC(MAKB, NVPT) VALUES ('KB001', 'BT001');
INSERT INTO DONTHUOC(MAKB, NVPT) VALUES ('KB002', 'KT001');
INSERT INTO DONTHUOC(MAKB, NVPT) VALUES ('KB003', 'BT001');
INSERT INTO DONTHUOC(MAKB, NVPT) VALUES ('KB004', 'KT001');
INSERT INTO DONTHUOC(MAKB, NVPT) VALUES ('KB005', 'BT001');

-----BANG HO SO DICH VU
INSERT INTO HOSO_DICHVU(MAKB, MADV, NGAY_GIO, NGUOITHUCHIEN, KETLUAN) VALUES ('KB002', 'DV001', to_date('22-01-2021','dd-mm-yyyy'), 'BS002', NULL);
INSERT INTO HOSO_DICHVU(MAKB, MADV, NGAY_GIO, NGUOITHUCHIEN, KETLUAN) VALUES ('KB004', 'DV003', to_date('05-03-2021','dd-mm-yyyy'), 'TT001', NULL);
INSERT INTO HOSO_DICHVU(MAKB, MADV, NGAY_GIO, NGUOITHUCHIEN, KETLUAN) VALUES ('KB003', 'DV005', to_date('11-10-2021','dd-mm-yyyy'), 'BS002', NULL);
INSERT INTO HOSO_DICHVU(MAKB, MADV, NGAY_GIO, NGUOITHUCHIEN, KETLUAN) VALUES ('KB005', 'DV002', to_date('18-02-2021','dd-mm-yyyy'), 'TT001', NULL);
INSERT INTO HOSO_DICHVU(MAKB, MADV, NGAY_GIO, NGUOITHUCHIEN, KETLUAN) VALUES ('KB001', 'DV004', to_date('30-05-2021','dd-mm-yyyy'), 'BS002', NULL);
/
SELECT* FROM QUANLY_USER;
/
----------------MANANGE USER, ROLE---------------
-----CREATE ROLE, GRANT PRIVS TO ROLE-----
DROP ROLE R_QLBV_TIEPTAN;
DROP ROLE R_QLBV_BACSI;
DROP ROLE R_QLBV_KETOAN;
DROP ROLE R_QLBV_TAIVU;
DROP ROLE R_QLBV_BANTHUOC;
DROP ROLE R_QLBV_QLNHANSU;
DROP ROLE R_QLBV_QLTAIVU;
/
CREATE ROLE R_QLBV_TIEPTAN;
CREATE ROLE R_QLBV_BACSI;
CREATE ROLE R_QLBV_KETOAN;
CREATE ROLE R_QLBV_TAIVU;
CREATE ROLE R_QLBV_BANTHUOC;
CREATE ROLE R_QLBV_QLNHANSU;
CREATE ROLE R_QLBV_QLTAIVU;
grant connect to R_QLBV_TIEPTAN, R_QLBV_BACSI, R_QLBV_KETOAN, R_QLBV_TAIVU, R_QLBV_BANTHUOC, R_QLBV_QLNHANSU, R_QLBV_QLTAIVU;
/

-----CREATE USER, GRANT PRIVS, ROLE TO USER-----
BEGIN
    SP_DROP_USER;
END;
/
BEGIN
    SP_CREATE_USER;
END;
/

----

